{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "definitions": {
    "access-control": {
      "additionalProperties": false,
      "properties": {
        "apply_require_all_dirspace_access": {
          "default": true,
          "type": "boolean"
        },
        "enabled": {
          "default": true,
          "type": "boolean"
        },
        "plan_require_all_dirspace_access": {
          "default": false,
          "type": "boolean"
        },
        "policies": {
          "items": {
            "$ref": "#/definitions/access-control-policy"
          },
          "type": "array"
        },
        "terrateam_config_update": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "unlock": {
          "$ref": "#/definitions/access-control-match-list"
        }
      },
      "type": "object"
    },
    "access-control-match-list": {
      "items": {
        "type": "string"
      },
      "type": "array"
    },
    "access-control-policy": {
      "additionalProperties": false,
      "properties": {
        "apply": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "apply_autoapprove": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "apply_force": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "apply_with_superapproval": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "plan": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "superapproval": {
          "$ref": "#/definitions/access-control-match-list"
        },
        "tag_query": {
          "type": "string"
        }
      },
      "required": [
        "tag_query"
      ],
      "type": "object"
    },
    "automerge": {
      "additionalProperties": false,
      "properties": {
        "delete_branch": {
          "default": false,
          "type": "boolean"
        },
        "enabled": {
          "default": false,
          "type": "boolean"
        }
      },
      "type": "object"
    },
    "destination-branch-name": {
      "type": "string"
    },
    "destination-branch-object": {
      "additionalProperties": false,
      "properties": {
        "branch": {
          "type": "string"
        },
        "source_branches": {
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "required": [
        "branch"
      ],
      "type": "object"
    },
    "dir": {
      "additionalProperties": false,
      "properties": {
        "create_and_select_workspace": {
          "default": true,
          "type": "boolean"
        },
        "stacks": {
          "$ref": "#/definitions/workspaces"
        },
        "tags": {
          "$ref": "#/definitions/tags"
        },
        "when_modified": {
          "$ref": "#/definitions/when-modified-nullable"
        },
        "workspaces": {
          "$ref": "#/definitions/workspaces"
        }
      },
      "type": "object"
    },
    "drift": {
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "default": false,
          "type": "boolean"
        },
        "reconcile": {
          "default": false,
          "type": "boolean"
        },
        "schedule": {
          "enum": [
            "hourly",
            "daily",
            "weekly",
            "monthly"
          ],
          "type": "string"
        }
      },
      "required": [
        "schedule"
      ],
      "type": "object"
    },
    "hook": {
      "additionalProperties": false,
      "properties": {
        "post": {
          "$ref": "#/definitions/hook-list"
        },
        "pre": {
          "$ref": "#/definitions/hook-list"
        }
      },
      "type": "object"
    },
    "hook-list": {
      "items": {
        "$ref": "#/definitions/hook-op"
      },
      "type": "array"
    },
    "hook-op": {
      "oneOf": [
        {
          "$ref": "#/definitions/hook-op-drift-create-issue"
        },
        {
          "$ref": "#/definitions/hook-op-env-exec"
        },
        {
          "$ref": "#/definitions/hook-op-env-source"
        },
        {
          "$ref": "#/definitions/hook-op-oidc"
        },
        {
          "$ref": "#/definitions/hook-op-run"
        },
        {
          "$ref": "#/definitions/hook-op-slack"
        }
      ]
    },
    "hook-op-drift-create-issue": {
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "drift_create_issue",
          "type": "string"
        }
      },
      "required": [],
      "type": "object"
    },
    "hook-op-env-exec": {
      "additionalProperties": false,
      "properties": {
        "cmd": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "method": {
          "const": "exec",
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "trim_trailing_newlines": {
          "default": true,
          "type": "boolean"
        },
        "type": {
          "const": "env",
          "type": "string"
        }
      },
      "required": [
        "type",
        "name",
        "cmd"
      ],
      "type": "object"
    },
    "hook-op-env-source": {
      "additionalProperties": false,
      "properties": {
        "cmd": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "method": {
          "const": "source",
          "type": "string"
        },
        "type": {
          "const": "env",
          "type": "string"
        }
      },
      "required": [
        "cmd",
        "method",
        "type"
      ],
      "type": "object"
    },
    "hook-op-oidc": {
      "oneOf": [
        {
          "$ref": "#/definitions/hook-op-oidc-aws"
        },
        {
          "$ref": "#/definitions/hook-op-oidc-gcp"
        }
      ]
    },
    "hook-op-oidc-aws": {
      "additionalProperties": false,
      "properties": {
        "assume_role_arn": {
          "type": "string"
        },
        "assume_role_enabled": {
          "default": true,
          "type": "boolean"
        },
        "audience": {
          "type": "string"
        },
        "duration": {
          "default": 3600,
          "type": "integer"
        },
        "provider": {
          "const": "aws",
          "type": "string"
        },
        "region": {
          "default": "us-east-1",
          "type": "string"
        },
        "role_arn": {
          "type": "string"
        },
        "session_name": {
          "default": "terrateam",
          "type": "string"
        },
        "type": {
          "const": "oidc",
          "type": "string"
        }
      },
      "required": [
        "role_arn",
        "type"
      ],
      "type": "object"
    },
    "hook-op-oidc-gcp": {
      "additionalProperties": false,
      "properties": {
        "access_token_lifetime": {
          "default": 3600,
          "type": "integer"
        },
        "access_token_subject": {
          "type": "string"
        },
        "audience": {
          "type": "string"
        },
        "project_id": {
          "type": "string"
        },
        "provider": {
          "const": "gcp",
          "type": "string"
        },
        "service_account": {
          "type": "string"
        },
        "type": {
          "const": "oidc",
          "type": "string"
        },
        "workload_identity_provider": {
          "type": "string"
        }
      },
      "required": [
        "provider",
        "service_account",
        "type",
        "workload_identity_provider"
      ]
    },
    "hook-op-run": {
      "additionalProperties": false,
      "properties": {
        "capture_output": {
          "default": false,
          "type": "boolean"
        },
        "cmd": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "run_on": {
          "$ref": "#/definitions/run-on"
        },
        "type": {
          "const": "run",
          "type": "string"
        }
      },
      "required": [
        "type",
        "cmd"
      ],
      "type": "object"
    },
    "hook-op-slack": {
      "additionalProperties": false,
      "properties": {
        "msg": {
          "type": "string"
        },
        "run_on": {
          "$ref": "#/definitions/run-on"
        },
        "type": {
          "const": "slack",
          "type": "string"
        }
      },
      "required": [
        "type",
        "msg"
      ],
      "type": "object"
    },
    "permission": {
      "items": {
        "additionalProperties": false,
        "properties": {
          "id": {
            "type": "string"
          },
          "permissions": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "permissions"
        ],
        "type": "object"
      },
      "type": "array"
    },
    "retry": {
      "additionalProperties": false,
      "properties": {
        "backoff": {
          "default": 1.5,
          "type": "number"
        },
        "enabled": {
          "default": false,
          "type": "boolean"
        },
        "initial_sleep": {
          "default": 5,
          "type": "integer"
        },
        "tries": {
          "default": 3,
          "type": "integer"
        }
      },
      "type": "object"
    },
    "run-on": {
      "enum": [
        "failure",
        "always",
        "success"
      ],
      "type": "string"
    },
    "tags": {
      "items": {
        "type": "string"
      },
      "type": "array"
    },
    "terraform-version": {
      "type": "string"
    },
    "version-1": {
      "additionalProperties": false,
      "properties": {
        "access_control": {
          "$ref": "#/definitions/access-control"
        },
        "apply_requirements": {
          "additionalProperties": false,
          "properties": {
            "checks": {
              "additionalProperties": false,
              "properties": {
                "approved": {
                  "additionalProperties": false,
                  "properties": {
                    "count": {
                      "default": 1,
                      "type": "integer"
                    },
                    "enabled": {
                      "default": false,
                      "type": "boolean"
                    }
                  },
                  "type": "object"
                },
                "merge_conflicts": {
                  "additionalProperties": false,
                  "properties": {
                    "enabled": {
                      "default": true,
                      "type": "boolean"
                    }
                  },
                  "type": "object"
                },
                "status_checks": {
                  "additionalProperties": false,
                  "properties": {
                    "enabled": {
                      "default": true,
                      "type": "boolean"
                    },
                    "ignore_matching": {
                      "items": {
                        "type": "string"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              },
              "type": "object"
            },
            "create_pending_apply_check": {
              "default": true,
              "type": "boolean"
            }
          },
          "type": "object"
        },
        "automerge": {
          "$ref": "#/definitions/automerge"
        },
        "checkout_strategy": {
          "default": "merge",
          "enum": [
            "merge",
            "checkout"
          ],
          "type": "string"
        },
        "cost_estimation": {
          "additionalProperties": false,
          "properties": {
            "currency": {
              "default": "USD",
              "type": "string"
            },
            "enabled": {
              "default": true,
              "type": "boolean"
            },
            "provider": {
              "default": "infracost",
              "enum": [
                "infracost"
              ],
              "type": "string"
            }
          },
          "type": "object"
        },
        "create_and_select_workspace": {
          "default": true,
          "type": "boolean"
        },
        "default_tf_version": {
          "$ref": "#/definitions/terraform-version"
        },
        "destination_branches": {
          "items": {
            "oneOf": [
              {
                "$ref": "#/definitions/destination-branch-name"
              },
              {
                "$ref": "#/definitions/destination-branch-object"
              }
            ]
          },
          "type": "array"
        },
        "dirs": {
          "additionalProperties": {
            "$ref": "#/definitions/dir"
          },
          "type": "object"
        },
        "drift": {
          "$ref": "#/definitions/drift"
        },
        "enabled": {
          "default": true,
          "type": "boolean"
        },
        "hooks": {
          "additionalProperties": false,
          "properties": {
            "all": {
              "$ref": "#/definitions/hook"
            },
            "apply": {
              "$ref": "#/definitions/hook"
            },
            "plan": {
              "$ref": "#/definitions/hook"
            }
          },
          "type": "object"
        },
        "parallel_runs": {
          "default": 3,
          "type": "integer"
        },
        "version": {
          "const": "1",
          "default": "1",
          "type": "string"
        },
        "when_modified": {
          "$ref": "#/definitions/when-modified"
        },
        "workflows": {
          "items": {
            "$ref": "#/definitions/workflow-entry"
          },
          "type": "array"
        }
      },
      "type": "object"
    },
    "when-modified": {
      "additionalProperties": false,
      "properties": {
        "autoapply": {
          "default": false,
          "type": "boolean"
        },
        "autoplan": {
          "default": true,
          "type": "boolean"
        },
        "autoplan_draft_pr": {
          "default": true,
          "type": "boolean"
        },
        "file_patterns": {
          "default": [
            "**/*.tf",
            "**/*.tfvars"
          ],
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "type": "object"
    },
    "when-modified-nullable": {
      "additionalProperties": false,
      "properties": {
        "autoapply": {
          "type": "boolean"
        },
        "autoplan": {
          "type": "boolean"
        },
        "autoplan_draft_pr": {
          "type": "boolean"
        },
        "file_patterns": {
          "items": {
            "type": "string"
          },
          "type": "array"
        }
      },
      "type": "object"
    },
    "workflow-entry": {
      "additionalProperties": false,
      "properties": {
        "apply": {
          "$ref": "#/definitions/workflow-op-list"
        },
        "cdktf": {
          "default": false,
          "type": "boolean"
        },
        "plan": {
          "$ref": "#/definitions/workflow-op-list"
        },
        "tag_query": {
          "type": "string"
        },
        "terraform_version": {
          "$ref": "#/definitions/terraform-version"
        },
        "terragrunt": {
          "default": false,
          "type": "boolean"
        }
      },
      "required": [
        "tag_query"
      ],
      "type": "object"
    },
    "workflow-op-apply": {
      "additionalProperties": false,
      "properties": {
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "extra_args": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "retry": {
          "$ref": "#/definitions/retry"
        },
        "type": {
          "const": "apply",
          "type": "string"
        }
      },
      "required": [
        "type"
      ],
      "type": "object"
    },
    "workflow-op-init": {
      "additionalProperties": false,
      "properties": {
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "extra_args": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "type": {
          "const": "init",
          "type": "string"
        }
      },
      "required": [
        "type"
      ],
      "type": "object"
    },
    "workflow-op-list": {
      "items": {
        "oneOf": [
          {
            "$ref": "#/definitions/workflow-op-init"
          },
          {
            "$ref": "#/definitions/workflow-op-plan"
          },
          {
            "$ref": "#/definitions/workflow-op-apply"
          },
          {
            "$ref": "#/definitions/hook-op-run"
          },
          {
            "$ref": "#/definitions/hook-op-slack"
          },
          {
            "$ref": "#/definitions/hook-op-env-exec"
          },
          {
            "$ref": "#/definitions/hook-op-env-source"
          },
          {
            "$ref": "#/definitions/hook-op-oidc"
          }
        ]
      },
      "type": "array"
    },
    "workflow-op-plan": {
      "additionalProperties": false,
      "properties": {
        "env": {
          "additionalProperties": {
            "type": "string"
          },
          "type": "object"
        },
        "extra_args": {
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "type": {
          "const": "plan",
          "type": "string"
        }
      },
      "required": [
        "type"
      ],
      "type": "object"
    },
    "workspaces": {
      "additionalProperties": {
        "additionalProperties": false,
        "properties": {
          "tags": {
            "$ref": "#/definitions/tags"
          }
        },
        "required": [
          "tags"
        ],
        "type": "object"
      },
      "type": "object"
    }
  },
  "oneOf": [
    {
      "$ref": "#/definitions/version-1"
    }
  ]
}
